{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="email-gradient-card p-4 mb-5">
            <div class="analysis-container animate__animated animate__fadeIn">
                <h2 class="mb-4 text-center">
                    <i class="fas fa-envelope text-primary me-2"></i>
                    Email Phishing Analysis
                </h2>
                <form method="POST" class="animate__animated animate__fadeInUp">
                    <div class="mb-4">
                        <label for="email_content" class="form-label">Email Content:</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light">
                                <i class="fas fa-envelope-open-text text-primary"></i>
                            </span>
                            <textarea class="form-control" id="email_content" name="email_content" rows="6" placeholder="Paste the suspicious email content here..." required>{{ email_content if email_content else '' }}</textarea>
                        </div>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg shadow">
                            <i class="fas fa-shield-alt me-2"></i>Analyze Email
                        </button>
                    </div>
                </form>
                {% if result %}
                <div class="mt-5 animate__animated animate__fadeIn">
                    <h3 class="text-center mb-4">Analysis Results</h3>
                    <div class="card mb-4 shadow-lg border-0" style="background: #f9fbfd; border-radius: 18px;">
                        <div class="card-header bg-gradient text-white" style="border-radius: 18px 18px 0 0;">
                            <h5 class="mb-0">Phishing Likelihood:
                                <span class="badge 
                                    {% if result.likelihood == 'High' %}bg-danger
                                    {% elif result.likelihood == 'Medium' %}bg-warning text-dark
                                    {% elif result.likelihood == 'Low' %}bg-info text-dark
                                    {% else %}bg-secondary{% endif %} animate__animated animate__pulse">
                                    {{ result.likelihood }}
                                </span>
                                <div class="progress mt-2" style="height: 10px;">
                                    <div class="progress-bar 
                                        {% if result.likelihood == 'High' %}bg-danger
                                        {% elif result.likelihood == 'Medium' %}bg-warning
                                        {% elif result.likelihood == 'Low' %}bg-info
                                        {% else %}bg-secondary{% endif %}"
                                        role="progressbar"
                                        style="width: {{ result.score }}%;"
                                        aria-valuenow="{{ result.score }}"
                                        aria-valuemin="0"
                                        aria-valuemax="100">
                                    </div>
                                </div>
                                <small class="text-light">Score: {{ result.score }}/100</small>
                            </h5>
                        </div>
                        <div class="card-body">
                            {% if result.suspicious_sender %}
                            <div class="alert alert-danger animate__animated animate__shakeX">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Suspicious Sender:</strong> The email sender appears to be suspicious or spoofed.
                            </div>
                            {% endif %}
                            {% if result.suspicious_links %}
                            <div class="alert alert-warning animate__animated animate__fadeIn">
                                <i class="fas fa-link me-2"></i>
                                <strong>Suspicious Links Detected:</strong>
                                <ul class="security-issues-list mb-0 mt-2">
                                    {% for link in result.suspicious_links %}
                                    <li>{{ link }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                            {% if result.suspicious_content %}
                            <div class="alert alert-info animate__animated animate__fadeIn">
                                <i class="fas fa-file-alt me-2"></i>
                                <strong>Suspicious Content Detected:</strong>
                                <ul class="security-issues-list mb-0 mt-2">
                                    {% for content in result.suspicious_content %}
                                    <li>{{ content }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                            {% if result.email_analysis %}
                            <div class="alert alert-secondary animate__animated animate__fadeIn">
                                <i class="fas fa-search me-2"></i>
                                <strong>Email Analysis:</strong>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <div class="domain-card">
                                            <h6 class="card-title">Sender Information</h6>
                                            <p class="mb-1"><strong>From:</strong> {{ result.email_analysis.sender }}</p>
                                            {% if result.email_analysis.reply_to %}
                                            <p class="mb-1"><strong>Reply-To:</strong> {{ result.email_analysis.reply_to }}</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="domain-card">
                                            <h6 class="card-title">Email Details</h6>
                                            <p class="mb-1"><strong>Subject:</strong> {{ result.email_analysis.subject }}</p>
                                            <p class="mb-1"><strong>Date:</strong> {{ result.email_analysis.date }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.email-gradient-card {
    background: radial-gradient(circle at 50% 50%, #f5fafd 0%, #e0eafc 40%, #b0c4de 100%);
    border-radius: 24px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.10);
}
.analysis-container {
    padding: 30px;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.97);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
}
.domain-card {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    color: #222;
}
.security-issues-list li {
    color: #333;
    background: #f8f9fa;
    border-left: 4px solid #3498db;
    margin-bottom: 8px;
    border-radius: 6px;
    padding: 8px 12px;
    animation: slideIn 0.5s ease-out forwards;
    opacity: 0;
    animation-fill-mode: forwards;
}
.security-issues-list li:nth-child(1) { animation-delay: 0.05s; }
.security-issues-list li:nth-child(2) { animation-delay: 0.1s; }
.security-issues-list li:nth-child(3) { animation-delay: 0.15s; }
.security-issues-list li:nth-child(4) { animation-delay: 0.2s; }
.security-issues-list li:nth-child(5) { animation-delay: 0.25s; }
.btn-primary {
    background: linear-gradient(135deg, #3498db, #2980b9);
    border: none;
    padding: 12px 35px;
    border-radius: 30px;
    font-weight: 600;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
}
.btn-primary:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
}
.input-group-text {
    background: #f8f9fa;
    border: none;
    padding: 15px 20px;
}
.form-control {
    border: none;
    padding: 15px 20px;
    font-size: 16px;
}
.form-control:focus {
    box-shadow: none;
    border-color: #3498db;
}
@keyframes slideIn {
    from { transform: translateX(-100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
</style>
{% endblock %}